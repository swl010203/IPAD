<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!--可视区宽度等与设备的宽度，禁止缩放，缩放比例1:1-->
    <meta name="App-config" content="fullscreen=yes,useHistoryState=yes,transition=yes">
    <!--保留系统的一些配置（历史记录，动画效果，全屏）-->
    <meta name="apple-mobile-web-app-capable" content="yes"><!--苹果专有的meta信息，允许网页以APP形式运行-->
    <meta name="apple-mobile-web-app-status-bar-style" content="black"><!--苹果专有的,头部bar的样式-->
    <title>抢购详情</title>
    <link rel="stylesheet" type="text/css" href="../../css/user/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/user/index.css"/>
	<script type="text/javascript" src="../../script/jquery_2_1_4.js"></script>
	<script src="../../script/user/index.js"></script>
    <script src="../../script/user/gindex.js"></script>
    <script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/app.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/account/swiper.min.css"/>
<script type="text/javascript" src="../../script/swiper1.min.js"></script>
	<style>
		.swiper-container{overflow: hidden;}
		#desc img{width:100%;}
		#desc table{width:100%!important;}
		#desc table img{width:100%;}
		.gbrand-btn .gbrand-btn-right {
			width:30%;
			text-align: center;
			display: inline-block;
			position: absolute;
			top: 0;
			background: url(../../images/user/app_122.png) no-repeat center;
			margin-left: 70%;
			height: 52px;
			line-height: 42px;
			color: #fff;
			font-size:20px;
			background-size: cover;
			border: none;
			-webkit-appearance: none;
			}
			.outLunboImg .swiper-container{width: 100%;height: 256px;}
			/*修改内部单元的宽度和高度*/
			.outLunboImg .swiper-slide {width:624px;height: 256px;}
			.outLunboImg .swiper-slide img{width: 100%;height: 100%;}
			.outLunboImg .pagination {position: absolute;z-index: 20;left: 0;right: 0;margin:0 auto;text-align:center;bottom: 10px;}
			.outLunboImg .swiper-pagination-switch {display: inline-block;width: 8px;height: 8px;border-radius: 8px;background: #222;
			  margin-right: 5px;opacity: 0.8;border: 1px solid #fff;cursor: pointer;}
			.outLunboImg .swiper-active-switch {background: #fff;}
			/*修改左右遮罩层的宽度*/
			.outLunboImg .shadeLeft{position:absolute;left:0;top:0;width:200px;height:256px;z-index:30;
				background-color:#000000;filter:alpha(opacity=50);-moz-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;}
			.outLunboImg .shadeRight{position:absolute;right:0;top:0;width:200px;height:256px;opacity:0.8;z-index:30;
				background-color:#000000;filter:alpha(opacity=50);-moz-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;}
			.swiper-slide{
				height:265px;
				
			}
			.swiper-slide img{
				width: 100%;
				height:100%;
				
			}
	</style>
</head>
<body style="height:100%;">
<div style="height:100%;">
    <!--头部-->
    <!--<div class="gxiangqing">
        <span style="z-index:9999;">商品详情</span>
        <i class="gxq-pic1" onclick="bank();" style="z-index:9999;"></i>
        <i class="gxq-pic2" style="z-index:9999;" id='shoucang'></i>              
    </div> -->

	
		<div class="outLunboImg">
			<div class="swiper-container">
				<div class="shadeLeft"></div>
				<div class="shadeRight"></div>
			    <div class="swiper-wrapper" id="acgoods">
				    <!--<div class="swiper-slide">
				      	<img src="../images/account/201.jpg"/>
				    </div>-->
				    
				</div>
			    <div class="pagination"></div>
			</div>
		</div>
<!--顶部结束-->
    <!-- 内容开始 -->

        <div class="gshengji">
            <p id="goodsname" style="height: auto;"></p>
            <div class="gshengji-price" style="float:left;">
                <span class="gprice0">¥ </span><span class="gprice1" id="price">0.00</span><span class="gprice2">&nbsp;抢购价</span>
            </div>
             <div class="gshengji-time">
                    <span class="gtime-0" id="timetype">活动进行中</span>
                    <div class="gtime-1" style='display:none;'>
                        <span class="gtime-2 hou">00</span><i class="gtime-6">:</i>
                        <span class="gtime-3 min">00</span><i class="gtime-7">:</i>
                        <span class="gtime-5 sec">00</span>
                    </div>

               <span class="gtime-4">还剩<i id="num">0</i>份</span>
            </div>
            <div style="clear:both;"></div>
        </div>
        
        <div class="gbrand" style="margin-top:0;">
            <div class="gbrand-com">
                <span class="gbrand-top">品牌</span>
                <span id='brand'></span>
            </div>
             <div class="gbrand-com">
                <span class="gbrand-bott">产品规格</span>
                <span id='guige'></span>
            </div>
        </div>
        <!--属性规格-->
		<div class="attr" style="background-color: #fff;overflow: hidden;color:#333;height:auto;margin-bottom: 10px;padding-left: 20px;padding-top: 20px;">
			<!--<div class="list">
				<div class="payList2 payList201">asdasd：</div>
				<div class="payListr" >
				     <div class="payListrli01">								     																		
						<label for="'+attr_val[j]['id']+'">attr_va</label>					
				     	<img style="width:30px;heihgt:30px;" src='' />			     	
					</div>	
					<div class="payListrli01">								     																		
						<label for="'+attr_val[j]['id']+'">attr_va</label>					
				     	<img style="width:30px;heihgt:30px;" src='http://123.57.36.72:8094/Uploads/Default/default.jpg' />			     	
					</div>					    																														
				</div>
			</div>
			<div class="list">
				<div class="payList2 payList201">asdasd：</div>
				<div class="payListr">
				     <div class="payListrli01">								     																		
						<label for="'+attr_val[j]['id']+'">attr_va</label>					
				     	<img style="width:30px;heihgt:30px;" src='' />			     	
					</div>
					<div class="payListrli01">								     																		
						<label for="'+attr_val[j]['id']+'">attr_va</label>					
				     	<img style="width:30px;heihgt:30px;" src='' />			     	
					</div>				    																														
				</div>
			</div>-->
		</div>
        <div class="gfankui" style="margin-bottom:60px;">
            <div class="gfankui_top">
                <i></i>
                <span>图文详情</span>

            </div>
            <div class="gtuwen" id="desc">
                <!--<span class="gtw-txt">主要材料是用寿司醋调味过的维持在人体体温的饭块，再加上鱼肉，海鲜，蔬菜或鸡蛋等作配料，其味道鲜美。</span>
                <img src="../../images/user/app_161.png" alt="" class="gtw-pic">-->
            </div>

        </div>
    <div class="gbrand-btn">
            <div class="gbrand-btn-left">
                <i class="gbrand-pic1" onclick="openCart();"></i>

                <i class="gbrand-pic4" id="cartnum">0</i>
                <div>
                    <span class="gbrand-pic2">￥</span><span class="gbrand-pic3" id="prices">0.00</span>
                </div>
            </div>
            <input type="button" value="马上抢" onclick="startget();" class="gbrand-btn-right">
    </div>
</div>

</body>
<script>                      
    var uid='';
    var aid='';
    var gid='';
    var starttime ='';
    var dingshiqi='';
    var sid='';
    apiready = function(){
    	if($api.getStorage('userinfo')){
    		uid=$api.getStorage('userinfo').uid;//用户id 
    	}
    	aid=api.pageParam.aid; //活动id
    	gid=api.pageParam.goods_id; //活动id
    	
    	//获取活动商品详情
    	getGoodsInfo();
    	getGoodsKucun(gid);
    };
    
    /*
	 * 获取商品规格
	 */
	function getGoodsKucun(id){
		api.ajax({
			url : ajax_url+'Index/Mall/getGoodsKucun',
			method : 'post',
			data : {
				values : {
				gid:id
				},
			}
		}, function(ret, err) {
		   if(ret){
			   if(ret.code){
				    var data=ret.data;
				    attr=data.attr;//商品属性
				    var attrHtml='';
				    attr_val=data.attrval;//商品属性值
				    if(attr!=null && attr.length>0){
					     for(var i in attr){
						     if(attr[i]['name']!=null){
						        attrHtml+='	<div class="list" style="background-color: #fff;">'+
									'<div class="payList2 payList201" style="width:20%;float:left;">'+attr[i]['name']+'：</div>'+
								'<div class="payListr" style="width:80%;float:left;">';
								   for(var  j in attr_val){
								    if(attr_val[j]['pid']==attr[i]['id']){
								     attrHtml+='<div class="payListrli01" style="heihgt:30px;float:left;">';								     																		
										attrHtml+='<label for="'+attr_val[j]['id']+'" style="width:auto;">'+attr_val[j]['color_name']+'</label>&nbsp;&nbsp;&nbsp;&nbsp;';
										if(attr_val[j]['img']){
								     		//attrHtml+='<img style="width:30px;heihgt:30px;" src='+attr_val[j]['img']+' />';
								     	}
									attrHtml+='</div>';
								    }
								   }
																																			
								attrHtml+='<div style="clear:both;"></div></div>'+
								'</div><div style="clear:both;"></div></br/>';
						     }				   
					     }
				    }
				    $(".attr").html(attrHtml);
			   }
		  	}else{
		  		_alert('网络连接失败,请稍后重试');
		  	}
		});
	}
	
	//购物车
	function openCart() {
		var uid = localStorage.getItem("uid");
		if (uid == '' || uid == null || typeof uid == undefined) {
			_openWinByUrl('login', '../login');
			return false;
		}
		_openWinByUrl('cart', '../cart', {
			'is_hide': 1,
			'frame_name': 'detail'
		});
	}
    
    //获取活动商品详情
    function getGoodsInfo(){
    	_ajax(ajax_url+'Index/Mall/getGoodsDetail',{gid:gid,ac_id:aid,uid:uid},'post',function(ret){
    		if(ret.status==1){
    			//收藏  			
    			var collectflag=0;
    			if(ret.collectGood==0){
    				collectflag=0;    				
    			}else{
    				collectflag=1;   				
    			}
    			api.sendEvent({
					name: 'mall_a_goodsdetailbody',
					extra: {
						key1: 'success',
						collectflag:collectflag
					}
				});	
    			
    			
    			//轮播图
				var html='';
				for(var i in ret.goodspic){
					html+='<div class="swiper-slide openshow swiper-no-swiping">';
	            	html+='<img style="width:100%;height:100%;"  src="'+ret.goodspic[i]+'" alt="">';
	            	html+='</div>';
				}
				$('#acgoods').html(html);
				
				//轮播执行
				var mySwiper = new Swiper('.swiper-container',{
				    pagination: '.pagination',
				    loop:true,
				//  eventTarget:container, //包含在container内的所有元素都可以触发移动
				    autoplay:2000,
				    autoplayDisableOnInteraction:false,
				    slidesOffsetBefore:200,
					slidesOffsetAfter:200,
				    paginationClickable: true,
				    slidesPerView: 'auto',
				    paginationAsRange : false
				});
			    
			    //商品信息
			    $('#goodsname').text(ret.goods.goods_name);
			    if(ret.ac_info.type!='full_reduction'  && ret.ac_info.type!='full_fold' ){
	    			$('#price').text(ret.ac_info.price);
			    	$('#prices').text(ret.ac_info.price);
	    		}else{
	    			$('#price').text(ret.goods.shop_price);
			    	$('#prices').text(ret.goods.shop_price);
	    		}			    			    
			    $('#num').text(ret.ac_info.number);
			    
			    if(ret.ac_info.type=='full_fold' ){
	    			$('.gprice2').attr('style','font-size:10px;');
			    	$('.gprice2').text(' 满￥'+ret.ac_info.full+'打'+ret.ac_info.fold+'折');
			    }
			    
			    if(ret.ac_info.type=='full_reduction' ){
			    	$('.gprice2').attr('style','font-size:10px;');
			    	$('.gprice2').text(' 满￥'+ret.ac_info.full+'减￥'+ret.ac_info.reduction);
			    }
			    
			    if(ret.ac_info.number<1){
			    	$('.gbrand-btn-right').attr('onclick','');
		        	$('.gbrand-btn-right').attr('style','background:#ccc;');
		        	$('.gbrand-btn-right').val('已抢完');
			    }
			    
			    //倒计时处理
			    if(ret.ac_info.start_time!=0 && ret.ac_info.end_time!=0){
			    	$('.gtime-1').attr('style','display:block;');
			    	var mydate =new Date();
				    if((ret.ac_info.start_time*1000) > mydate){
				    	$('#timetype').text('距开始');
				    	starttime=ret.ac_info.start_time*1000;
				    }else if((ret.ac_info.end_time*1000) > mydate){
				    	$('#timetype').text('距结束');
				    	starttime=ret.ac_info.end_time*1000;	
				    	
				    }
				    dingshiqi=setInterval(daojishi,1000);
			    }
			    
			    //属性
			    $('#brand').text(ret.goods.brand);	
			    $('#guige').text('1个/'+ret.goods.unit);	
			    sid=ret.goods.shop_id;
			    
			    //图文详情
			    $('#desc').html(ret.goods.goods_desc);
			    
			    //购物车
			    $('#cartnum').text(ret.cartnum);
			    
			}else{
				_toast(ret.msg);
			}
			  		
    	});
    }
    
    //马上抢
    function startget(){
  	 	api.openFrame({
            name: 'mall_attr',
            url: 'mall_attr.html',
            bounces: false,
            rect: {
                x: 0,
                y: 0,
                w: 'auto',
                h: 'auto'
            },
			pageParam:{
				id:gid,
				type:2,
				sid:sid,
				aid:aid
			}
        });
    }
    
    //收藏
    function shoucang(type){
    	if(!uid){
    		_openWinByUrl('login','../login');return;
    	}
    
    	if(type==2){
    		_ajax(ajax_url + 'Index/Mall/goodsCancel',{gid:gid,uid:uid},'post', function(ret) {
				if (ret.status==1) { 
					_toast('已取消收藏');
					$('#shoucang').attr('style','z-index:9999;');
    				$('#shoucang').attr('onclick','shoucang(1);');
				}
			});
    	}else{
    		_ajax(ajax_url + 'Index/Mall/collectgoods',{gid:gid,uid:uid},'post', function(ret) {
				if (ret.status==1) { 
					_toast('已收藏');
					$('#shoucang').attr('style','z-index:9999;background: url(../../images/user/yishoucang.png) no-repeat center;background-size: contain;');
    				$('#shoucang').attr('onclick','shoucang(2);');
				}
			});
    	}
    }
    
                
    // 倒计时
	function daojishi() {
        var nowtime = new Date();
        var time = starttime - nowtime;
        var day = parseInt(time / 1000 / 60 / 60 / 24);
        var hour = parseInt(time / 1000 / 60 / 60 % 24);
        var minute = parseInt(time / 1000 / 60 % 60);
        var seconds = parseInt(time / 1000 % 60);
        if((hour+day*24)<10){
            hour='0'+hour;
        }else{
        	hour=hour+day*24;
        }
        if(minute<10){
            minute='0'+minute;
        }
        if(seconds<10){
            seconds='0'+seconds;
        }
        $('.hou').html(hour);
        $('.min').html(minute);
        $('.sec').html(seconds);
        if(hour==0 && minute==0 && seconds==0 ){
        	window.clearInterval(dingshiqi);
        	$('.gbrand-btn-right').attr('onclick','');
        	$('.gbrand-btn-right').attr('style','background:#ccc;');
        	$('.gbrand-btn-right').val('活动结束');
        }
    }
    
    //关闭当前页
    function bank(){
    	api.closeWin();
    }
</script>
</html>
