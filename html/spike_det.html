<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	</head>

	<body class="mui-android mui-android-8 mui-android-8-0">
		<header id="header" class="mui-bar mui-bar-transparent" style="background-color: rgba(230, 60, 37, 0);">
			<a class="mui-pull-left back_icon" id="fanhui_btn"></a>
			<h1 class="mui-title headerTit">苹果</h1>
			<!--<a class="mui-pull-right share_icon fenxiang_click"></a>-->
		</header>
		<div class="mui-content">
			<div class="mui-slider mui_slider mui_slider_shangpin bgwhite">
				<div class="mui-slider-group mui-slider-loop" id="top_img_list">
					<!--第四个内容区-->
					<!--<div class="mui-slider-item mui-slider-item-duplicate">
						<img src="../images/index2.jpg" />
					</div>-->
					<!--第一个内容区容器-->
					<!--<div class="mui-slider-item">
						<img src="../images/pingguo.jpg" />
					</div>-->
					<!--第二个内容区-->
					<!--<div class="mui-slider-item">
						<img src="../images/pingguo2.jpg" />
					</div>-->
					<!--第三个内容区-->
					<!--<div class="mui-slider-item">
						<img src="../images/index1.jpg" />
					</div>-->
					<!--第四个内容区-->
					<!--<div class="mui-slider-item">
						<img src="../images/index2.jpg" />
					</div>-->
					<!--第一个内容区容器-->
					<!--<div class="mui-slider-item mui-slider-item-duplicate">
						<img src="../images/pingguo.jpg" />
					</div>-->
				</div>
			</div>
			 <style type="text/css">
                .title_start{
                    position: absolute;
                    left: -100px;
                    top:2px;
                }
                .bgccc{
                    background: #CCCCCC!important;
                }
            </style>
			<div class="shopInfoDiv bgwhite">
				<div>
					<div class="msInfo_div pt10 pb10 mb20 pl20 pr20 box-s">
						<p>
							<span class="fs24">￥</span>
							<span class="fs36" id="shop_price"></span> 
							<span class="fs24 oldPrice" id="market_price"></span>
						</p>
						<div class="djs_div" id="start_time_remind">
                            <p class="title_start" id="title_one">距离开抢还有：</p>
                            <span id="skill_ing_hours">00</span> :
                            <span id="skill_ing_minutes">00</span> :
                            <span id="skill_ing_seconds">00</span>
			        	</div>
					</div>
					<div class="pl20 pr20 box_s">
						<p class="fs28" id="goods_name"></p>
						<div class="shopDiv_infoPrice mui-row">
							<div>
								<div class="shop_label colorHei888 fs24 mt10">
									<span class="mr20"><i class="duihao_icon mr10"></i>当日达</span>
									<span class="mr20"><i class="duihao_icon mr10"></i>正品保障</span>
									<!--<span class="mr20"><i class="duihao_icon mr10"></i>支持七天无理由退货</span>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="shopInfoCon_tit colorHei888"><span>浏览图文详情</span></div>
			<div class="pl20 pr20 box_s" id="goods_desc">
				
			</div>
			
			
            <style>
            .mui-numbox [class*=btn-numbox], .mui-numbox [class*=numbox-btn]{
                width: 60px;
                font-size: 30px;
                z-index:100;
            }
            .mui_numbox{
                height: 40px;
                width: 170px;
                padding:0;
            }
            .mui_numbox_input{
                border: 1px solid black;
                margin: 0;
                padding: 0;
                /* margin-top: -30px; */
                position: absolute;
                /* width: 100%; */
                height: 40px!important;
                top: 0;
                font-size:16px!important;
            }
            .mui-numbox-btn-minus{
                top: -4px!important;
                height: 44px!important;
            }
            </style>

			
			<div style="height: 80px;"></div>
			<footer class="shopFooter">
				<div class="mui-row">
					<!--<div class="mui-col-sm-1 mui-col-xs-1">
						<div class="cart_blackIcon"><span class="mui-badge mui_badge"></span></div>
						<p class="fs24 mui-text-center">购物车</p>
					</div>-->
					<div class="mui-col-sm-1 mui-col-xs-1 shoucangN_iconClick" id="collect_div">
						<div class="shoucangN_icon" id="collect_status"></div>
						<p class="fs24 mui-text-center">收藏</p>
					</div>
					<div class="mui-col-sm-7 mui-col-xs-7">
                        <div class="mui-numbox mui_numbox" data-numbox-step="1" data-numbox-min="1" data-numbox-max="10000">
                            <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
                            <input class="mui-numbox-input mui_numbox_input" readonly="readonly" type="number" value="1" id="goods_number" />
                            <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
                        </div>
                    </div>
					<div class="mui-col-sm-4 mui-col-xs-4">
						<div class="buyNow fs32" onclick="buyNow();" id="buy_now">立即购买</div>
					</div>
				</div>
			</footer>
		</div>
	</body>
	<script src="../script/mui.min.js"></script>
	<script src="../script/jquery_2_1_4.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/app.js"></script>
	<script>
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		//点击分享出来弹层
//		$(".fenxiang_click").on("tap",function(){
//			share();
//			$(".mark_common").removeClass("mui-hidden");
//			$(".mark_share").slideDown();
//			show_mark();
//		})
		setTimeout(function(){
		    var gallery = mui('.mui-slider');
		    gallery.slider({
		         interval:1800//自动轮播周期，若为0则不自动播放，默认为0；
		    });
		},300);
	     window.onscroll = window.ontouchmove = function() {
	        var scrollY = $(document).scrollTop();// 获取垂直滚动的距离，即滚动了多少
	        if (scrollY > 1){ //如果滚动距离大于550px则隐藏，否则删除隐藏类
	            $("header").find(".headerTit").css("opacity",1);
	            $("header .back_icon").css("background","rgba(170,171,173,0) url(../images/back_icon.png) center center no-repeat");
	            $("header .share_icon").css("background","rgba(170,171,173,0) url(../images/share_icon.png) center center no-repeat");
	        } 
	        else{
	        	$("header").find(".headerTit").css("opacity",0);
				$("header .back_icon").css("background","rgba(170,171,173,1) url(../images/back_icon.png) center center no-repeat");
				$("header .share_icon").css("background","rgba(170,171,173,1) url(../images/share_icon.png) center center no-repeat");
	        }
	    };
//	    $(".shoucangN_iconClick").on("tap",function(){
//	    		if($(this).find(".shoucangN_icon").hasClass("shoucangY_icon")){
//	    			$(this).find(".shoucangN_icon").removeClass("shoucangY_icon");
//	    			mui.toast("取消成功")
//	    		}else{
//	    			$(this).find(".shoucangN_icon").addClass("shoucangY_icon");
//	    			mui.toast("收藏成功")
//	    		}
//	    })
	</script>
	
	
    <script type="text/javascript">
        var targetDate = '';
        var dingshiqi  = '';
        var is_ing     = 0;
        var gid = 0;
        var aid = 0;
        var uid = 0;
        apiready = function(){
            gid = api.pageParam.gid;
            aid = api.pageParam.aid;
            uid = localStorage.getItem('uid');
            //商品信息
            goods_detail();
        };

        //商品信息
        function goods_detail() {
            _ajax(ajax_url + "Index/Seckill/getGoodsDetail", {aid:aid, gid:gid, uid:uid}, 'post', function(ret) {
                if( ret.status == 1 ) {
                    var img_list = '';
                    $.each(ret.data.goods_pic_arr, function(key, val) {
                        if(key == 0) {
                            img_list += '<div class="mui-slider-item mui-slider-item-duplicate"><img src="'+val+'" /></div>';
                        } else {
                            img_list += '<div class="mui-slider-item"><img src="'+val+'" /></div>';
                        }
                        if( key == ret.data.goods_pic_arr.length-1 ) {
                            img_list += '<div class="mui-slider-item mui-slider-item-duplicate"><img src="'+val+'" /></div>';
                        }
                    });
                    $('#top_img_list').html( img_list );

                    $('#shop_price').html( ret.data.shop_price );
                    $('#market_price').html( '￥'+ret.data.market_price );
                    $('#title_one').html( ret.activity.title_one );

                    is_ing = ret.activity.is_ing;

                    if( ret.data.goods_number <= 0 ) {
                        $('#start_time_remind').html('已售罄');
                        $('#top_red_id').addClass( 'bgccc' );
                        $('.buyNow').addClass( 'bgccc' );
                        $('#collect_div').addClass( 'no_collect' );
                    } else if( ret.activity.is_ing == 1 ) {
                        $('#buy_now').text( '立即购买' );
                    } else if( ret.activity.is_ing == 0 ) {
                        if( ret.data.is_remind == 1 ) {
                            $('#buy_now').text( '取消提醒' );
                        } else {
                            $('#buy_now').text( '提醒我' );
                        }
                    }

                    if( ret.data.goods_number > 0 ) {
                        targetDate = ret.activity.is_ing == 1 ? ret.activity.end_time*1000 : ret.activity.start_time*1000;
                        dingshiqi = setInterval(update_time, 1000);//倒计时
                    }

                    $('#goods_name').html( ret.data.goods_name );
                    $('#goods_desc').html( ret.data.goods_desc );

                    //收藏状态
                    if( ret.data.collect_num > 0 ) {
                        $('#collect_status').addClass('shoucangY_icon');
                    } else {
                        $('#collect_status').removeClass('shoucangY_icon');
                    }

                    $('#cartnum').html( ret.data.cart_num );
                }
            });
        }

        //收藏
        $(".shoucangN_iconClick").on("tap",function(){
            if( $(this).hasClass('no_collect') ) {
                mui.toast( '商品已售罄，无法收藏' );
                return false;
            }
            var type = 0;
            if($(this).find(".shoucangN_icon").hasClass("shoucangY_icon")){
                //$(this).find(".shoucangN_icon").removeClass("shoucangY_icon");
                //mui.toast("取消成功");
                type = 0;
            }else{
                //$(this).find(".shoucangN_icon").addClass("shoucangY_icon");
                //mui.toast("收藏成功");
                type = 1;
            }
            if( typeof uid == 'undefined' || uid == 0 || uid == '' ) {
                api.openWin({
                    name : 'login',
                    url : '../login.html',
                    reload : true
                });
                return false;
            }
            var paramData = {aid:aid, gid:gid, uid:uid, type:type};
            _ajax(ajax_url + "Index/Seckill/collectGoods", paramData, 'post', function(ret) {
                if( ret.status == 1 ) {
                    if( type == 1 ) {
                        //$(this).find(".shoucangN_icon").addClass("shoucangY_icon");
                        $('#collect_status').addClass( 'shoucangY_icon' );
                        mui.toast("收藏成功");
                    } else {
                        //$(this).find(".shoucangN_icon").removeClass("shoucangY_icon");
                        $('#collect_status').removeClass( 'shoucangY_icon' );
                        mui.toast("取消成功");
                    }
                } else {
                    mui.toast( ret.msg );
                }
                return false;
            });
        });

        //立即购买
        function buyNow() {
//      	console.log(111111111);
            //判断用户登录
            if( typeof uid == 'undefined' || uid == 0 || uid == '' ) {
//          	console.log("uid"+uid);
                api.openWin({
                    name : 'login',
                    url : '../login.html',
                    reload : true
                });
                return false;
            }
            if( $('#buy_now').hasClass( 'bgccc' ) ) {
//          	console.log("没库存"+uid);
                //没库存
                return false;
            } else if( is_ing != 1 ) {
            	console.log("is_ing"+is_ing);
//              var remind = $('#buy_now').text();
                if( remind == '提醒我' || remind == '取消提醒' ) {
                    var type = remind == '提醒我' ? 1 : 2;
                    //提醒
                    _ajax(ajax_url + "Index/Seckill/remindSeckill", {aid:aid, gid:gid, type:type, uid:uid}, 'post', function(ret) {
                        if( ret.status == 1 ) {
                            if( remind == '提醒我' ) {
                                $('#buy_now').text( '取消提醒' );
                            } else {
                                $('#buy_now').text( '提醒我' );
                            }
                        } else {
                            _toast( ret.msg );
                        }
                    });
                }
                return false;
            }
//          console.log("is_ing"+is_ing);
            var num = $('#goods_number').val();
            //判断库存
            _ajax(ajax_url + "Index/Seckill/getGoodsNum", {gid:gid, aid:aid}, 'post', function(ret) {
                if( ret.status == 1 ) {
                    var goods_number = parseInt( ret.data.goods_number );
                    if( goods_number > 0 ) {
                        if( goods_number < parseInt( num ) ) {
                            mui.toast( '库存不足请重新选择数量!' );
                        } else {
                            //有库存 可以购买
                            var pram = {
                                aid: aid,
                                gid: gid,
                                num: num
                            };
                            _openWinByUrl( 'sure_order', './spike/sure_order',pram );
                            return false;
                        }
                    } else {
                        mui.toast( '该商品已被抢光!' );
                    }
                } else {
                    mui.toast( ret.msg );
                }
                return false;
            });
        }

        //更新时间的主函数,这是最常见的函数命名方式
        function update_time() {
            //双十一的时间
            //var targetDate = new Date(2018, 18, 12, 0, 0, 0);
            //var targetDate = 1545112143*1000;
            //获取当前时间
            var nowDate = new Date();
            //获取据目标时间的    秒数
            //console.log(targetDate);
            var edge_millisecond = parseInt((targetDate - nowDate)/1000);
            // 获取天数
            var edge_days = parseInt(edge_millisecond/(24*60*60));
            //获取小时数
            var edge_hours = parseInt(edge_millisecond%(24*60*60)/3600);
            //获取分钟数
            var edge_minutes = parseInt(edge_millisecond%(24*60*60)%(60*60)/60);
            //获取秒数
            var edge_seconds = parseInt(edge_millisecond%(24*60*60)%(60*60)%60);
            // 为了美观,使显示的数字一直保持两位
            if (edge_seconds<=9){
                edge_seconds = "0" + edge_seconds;
            }
            if (edge_minutes <=9){
                edge_minutes = "0" + edge_minutes;
            }
            if (edge_hours <=9){
                edge_hours = "0" + edge_hours;
            }
            if (edge_days <=9){
                edge_days = "0" + edge_days;
            }

            // 为了避免出现负值,时间全部归零
            if (nowDate >= targetDate){
                edge_days = "00";
                edge_hours = "00";
                edge_minutes = "00";
                edge_seconds = "00";
                window.clearInterval(dingshiqi);
            }

            $('#skill_ing_hours').html( edge_hours );
            $('#skill_ing_minutes').html( edge_minutes );
            $('#skill_ing_seconds').html( edge_seconds );
        }
    </script>
</html>