<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>华海</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<link href="../../css/index.css" rel="stylesheet" type="text/css" />
<link href="../../css/h_index.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="../../css/account/swiper.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/wxzf.css">
<script type="text/javascript" src="../../script/jquery_2_1_4.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/app.js"></script>
<script type="text/javascript" src="../../script/swiper1.min.js"></script>


</head>
<body>

<!-- 内容 -->
<div class="wp_100">
	<style type="text/css">
	.outLunboImg .swiper-container1{width: 100%;height: 256px;overflow:hidden;}
			/*修改内部单元的宽度和高度*/
			.outLunboImg .swiper-slide {width:624px;height: 256px;}
			.outLunboImg .swiper-slide img{width: 100%;height: 100%;}
			.outLunboImg .pagination {position: absolute;z-index: 20;left: 0;right: 0;margin:0 auto;text-align:center;bottom: 180px;}
			.outLunboImg .swiper-pagination-switch {display: inline-block;width: 8px;height: 8px;border-radius: 8px;background: #222;
			  margin-right: 5px;opacity: 0.8;border: 1px solid #fff;cursor: pointer;}
			.outLunboImg .swiper-active-switch {background: #fff;}
			/*修改左右遮罩层的宽度*/
			.outLunboImg .shadeLeft{position:absolute;left:0;top:0;width:200px;height:256px;z-index:30;
				background-color:#000000;filter:alpha(opacity=50);-moz-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;}
			.outLunboImg .shadeRight{position:absolute;right:0;top:0;width:200px;height:256px;opacity:0.8;z-index:30;
				background-color:#000000;filter:alpha(opacity=50);-moz-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;}
	.fastImga img{    border-radius: 50%;}
	.brand_guigecon{border-top:none}
	.jifen_icon{height: 0.3rem;}
.swiper-slide{
		height:265px;
	}
	.swiper-slide img{
		width: 100%;
		height:100%
	}
	.pinpai_intrcon img {display:block;margin:0px;padding:0px;}
	.goods_desc img{width:100%;}
	.goods_desc table{width:100%!important;}
	.goods_desc table img{width:100%;}
</style>
<div class="outLunboImg">
			<div class="swiper-container1">
				<div class="shadeLeft swiper-no-swiping"></div>
				<div class="shadeRight swiper-no-swiping"></div>
			    <div class="swiper-wrapper goodsbanner">
				    <!--<div class="swiper-slide">
				      	<img src="../images/account/201.jpg"/>
				    </div>-->
				    
				</div>
			    <div class="pagination"></div>
			</div>
		</div>
<!-- 商品名称 -->
	<div class="good_detail">
		<p class="good_detailtxt txt2"><a href="javascript:void(0)" class="goods_name">
</a></p>
<p class="good_detailprice">
	<span class="good_detailpricespan"><span class="shop_price"></span><span style="font-size: 18px">积分</span></span>
	
</p>

	</div>

	<!-- 促销 -->
<div class="sales_promotion coupons" style="display:none">
	<div class="to_coupon">
	<div class="to_couponcon">
		<a href="#" class=""></a>
		<span class="to_coupontxt">促销</span>
		<ul class="to_couponul couponslist">
<!--			<li><a href="#" class="to_coupona"><span class="to_couponspan">满999减10</span></a></li>
			<li><a href="#" class="to_coupona"><span class="to_couponspan">满99减3</span></a></li>
			<li><a href="#" class="to_coupona"><span class="to_couponspan">满49减1</span></a></li>-->
		</ul>
	</div>
</div>
</div>
<!-- 品牌规格 -->
<div class="brand_guige">
	<a href="#" class="brand_guigecon">
		<div class="brand_guigeconl dy_dd">品牌</div>
		<div class="brand_guigeconr dy_dd brand"></div>
	</a>
</div>

<!-- 图文详情 -->
<div class="pinpai_intr">
	<div class="pinpai_intrtop"><i class="good_detailicon"></i>图文详情</div>
	<div class="pinpai_intrcon goods_desc" style="padding: 0;" >
		 
	</div>
</div>
</div>



<!--浮动层-->

<div class="ftc_wzsf">
  <div class="srzfmm_box">
    <div class="qsrzfmm_bt clear_wl"> <img src="../../images/xx_03.jpg" class="tx close fl" ><span class="fl">请输入支付密码</span> </div>
    <div class="zfmmxx_shop">
      <div class="mz ordername"></div>
      <div class="wxzf_price score">￥0.00</div>
    </div>
    
    <ul class="mm_box">
      <li pwd=""></li>
      <li pwd=""></li>
      <li pwd=""></li>
      <li pwd=""></li>
      <li pwd=""></li>
      <li pwd=""></li>
    </ul>
  </div>
  <div class="numb_box">
    <div class="xiaq_tb"> <img src="../../images/jftc_14.jpg" height="10"> </div>
    <ul class="nub_ggg">
      <li><a href="javascript:void(0);">1</a></li>
      <li><a href="javascript:void(0);" class="zj_x">2</a></li>
      <li><a href="javascript:void(0);">3</a></li>
      <li><a href="javascript:void(0);">4</a></li>
      <li><a href="javascript:void(0);" class="zj_x">5</a></li>
      <li><a href="javascript:void(0);">6</a></li>
      <li><a href="javascript:void(0);">7</a></li>
      <li><a href="javascript:void(0);" class="zj_x">8</a></li>
      <li><a href="javascript:void(0);">9</a></li>
      <li><span></span></li>
      <li><a href="javascript:void(0);" class="zj_x">0</a></li>
      <li><span  class="del" > <img src="../../images/jftc_18.jpg"   ></span></li>
    </ul>
  </div>
  <div class="hbbj"></div>
</div>
<!-- banner轮播js -->
<script src="js/swiper.min.js"></script>
<script type="text/javascript">
/*$(function(){
	// 选择规格
	$('.brand_chanpin').click(function(){
		$('.maskBg').show();
		$('.etc_pay').stop().slideDown(1000);
	})
	$('.bot_btnapay').click(function(){
		$('.maskBg').hide();
		$('.etc_pay').stop().slideUp(1000);
	})
})*/



/**
 * 清除支付密码 
 */
function clearPayPwd(){
	paypassword="";
	$(".mm_box li").attr('pwd','');
	$(".mm_box li").removeClass("mmdd");
	i1 = 0;
	is_pay_status = 1;
	
}
	
$(function(){
	//出现浮动层
	$(".ljzf_but1").click(function(){
		
	});
	//关闭浮动  清除支付密码
	$(".close").click(function(){
		$(".ftc_wzsf").hide();
		i = 0;
		clearPayPwd();
	});
		//数字显示隐藏
		$(".xiaq_tb").click(function(){
		//$(".numb_box").slideUp(500);
		});
		$(".mm_box").click(function(){
			//$(".numb_box").slideDown(500);
		});
		//----
		var i = 0;
		$(document).on('touchend',".nub_ggg li a", function(){
			
		//$(".nub_ggg li a").change(function(){
			i++;
			var pwd =$(this).parent("li").index()+1;
			if(pwd ==11){
				pwd =0 ;
			}
		
			if(i<6){
				$(".mm_box li").eq(i-1).addClass("mmdd");
				$(".mm_box li").eq(i-1).attr("pwd",pwd);
				}else{
					$(".mm_box li").eq(i-1).attr("pwd",pwd);
					$(".mm_box li").eq(i-1).addClass("mmdd"); 
					if(i>6){
						i=6;
					}
					setTimeout(function(){
						//验证支付密码 并支付
						var paypassword="";
						$(".mm_box li").each(function(){
							paypassword+=$(this).attr('pwd');
						});
						order(paypassword);
						
					},10);
					//window.document.location="cg.html"
			 	} 
		});
 		$(document).on('touchend',".nub_ggg li .del", function(){
		//$(".nub_ggg li .del").click(function(){
			if(i>0){
				i--;
				$(".mm_box li").eq(i).removeClass("mmdd");
				$(".mm_box li").eq(i).attr("pwd","");
				i==0;
				}
			//alert(i);
		}); 
});

/**
 * 提交订单信息
 */
function order(paypassword){

	if(typeof userinfo ==undefined || userinfo ==''  || userinfo ==null){
		_openWinByUrl('login','../login');
		return false;
	}

	//判断用户积分
	if(Number(userscore)<Number(goods_price)){
	 _toast('积分不足');
	 return false;
	}
	var carttype=$("input[name=carttype]:checked").val();
		api.ajax({
			url : ajax_url+'Index/Score/order',
			method : 'post',
			data : {
				values : {
				gid:goods_id,
				uid :userinfo.uid,
				goods_amount:goods_price,
				carttype:carttype,
				paypassword:paypassword
				},
			}
		}, function(ret, err) {
		
		  if(ret){
		    if(ret.code){
		    
				
				api.sendEvent({
	                name:'close_jifen_goodsdetail_pay'
                });
			    _toast(ret.msg,function(){
			    	
			    	_openWinByUrl('jifen_order_list_window_head','../window_head',{'furl':'./user/jifen_order_list','frame':'jifen_order_list','title':'积分订单'});
			    },1500);
		    
		   
			
		    }else{
		    	clearPayPwd();
		     _toast(ret.msg);
		    }
		  }else{
		  _alert('网络连接失败,请稍后重试');
		  }
		})
	
}
	
function payorder(){
	if(userinfo  =='undefined'  ||  userinfo ==''  ||userinfo ==null){
		_toast('请先登录',function(){
			_openWinByUrl('login','../login');
		});
		return false;
	}
	

	_ajax(ajax_url+'Index/Score/getMember',{
			gid:goods_id,
			uid :userinfo.uid,
	},'post', function(ret, err) {
		
	  if(ret){
	    if(ret.status==1){
	    	userscore=ret.score;
	    
	    	card_default_pwd = ret.card_default_pwd;
	    	if(card_default_pwd ==1){
				_toast('请先前往一开通修改默认密码',function(){
					
					_openWinByUrl('card_window_head','../window_head',{'redirect_url':'jifen_goodsdetail','furl':'./card/card','frame':'card','title':'惠通卡'});
				},1500);
				return false;
			}
			
			//$(".ftc_wzsf").show();
			api.sendEvent({
	            name:'jifen_detail_pay'
            });

	    }
	  }else{
	  	_alert('网络连接失败,请稍后重试');
	  }
	
	})
		

}
var goods_id =0;
var userinfo = "";
apiready=function(){
	userinfo = $api.getStorage('userinfo');
	 	//改变商品价格和市场价
		api.addEventListener({
		    name: 'jifenattr'
		}, function(ret, err) {
		    if(ret && ret.value){
					if (ret.value.key1 == 'success') {	
					    $(".shop_price").html(ret.value.shop_price);//商品价格                     									  											 
					}
				}
		});
		

		
		api.addEventListener({
	        name:'suborder_pay'
        },function(ret,err){
        	paypassword = ret.value.paypassword;
        	order(paypassword);
        	//coding...
        });
		
		
		
		//去结算
//		api.addEventListener({
//	        name:'suborder'
//      },function(ret,err){
//      	payorder();
//      });
		
		
  goods_id=api.pageParam['goods_id'];
  getinfo(goods_id);
  
  
  
};
/*
 * 获取商品信息
 */
function detail_siwper_photo(index){
	photoBrowser(detail_swiper_path,index);
}

/*
 * 获取商品详情
 */
function getinfo(id){
		api.ajax({
				url : ajax_url+'Index/Score/getGoodsDetail',
				method : 'post',
				data : {
					values : {
					gid:id,
					uid:localStorage.getItem("uid")
					},
				}
			}, function(ret, err) {
			  if(ret){
			    if(ret.status==1){
			     var goods=ret.goods;//商品详情
			     var goodspic=ret.goodspic;//商品相册
			     var goodsbannerHtml=''; //banner
			     var couponsHtml='';//优惠券
			     
			     detail_swiper_path=[];
			     var detail_swiper_path_k = 0;
			     if(goodspic!=null &&goodspic.length>0){
//						$(".goodsbanner").css('height',api.winWidth);
					for(var i in goodspic){
				      	detail_swiper_path[detail_swiper_path_k]=goodspic[i];
				      	goodsbannerHtml+='<div onclick="detail_siwper_photo('+detail_swiper_path_k+')" class="swiper-slide swiper-no-swiping" ><img src="'+goodspic[i]+'" width="100%"></div>';
				      	detail_swiper_path_k++;
				    }
				    $(".goodsbanner").html(goodsbannerHtml);
				     var mySwiper = new Swiper('.swiper-container1',{
				    pagination: '.pagination',
				    loop:true,
				//  eventTarget:container, //包含在container内的所有元素都可以触发移动
				    autoplay:2000,
				    autoplayDisableOnInteraction:false,
				    slidesOffsetBefore:200,
					slidesOffsetAfter:200,
				    paginationClickable: true,
				    slidesPerView: 'auto',
				    paginationAsRange : false
				})
				     
				}
			     //商品轮播
			     
			     
				
                
                $(".goods_name").html(goods.goods_name);//商品名称
                $(".shop_price").html(goods.shop_price);//商品价格
                $(".market_price").html(goods.market_price);//商品市场价格
                $(".goods_desc").html(goods.goods_desc);//商品描述  
                 $(".brand").html(goods.brand);//品牌
                 goods_price = goods.shop_price;
                 goods_number=goods.goods_number;
                 $(".score").html("金额:"+goods_price);
                      	api.sendEvent({
							name : 'jifengoodsdetail',
							extra : {
								key1 : 'success',
								shop_price:goods.shop_price,
								goods_number:goods.goods_number
							}
						});
			    }
			  }else{
			  _alert('网络连接失败,请稍后重试');
			  }
			})
}


</script>
</body>
</html>
